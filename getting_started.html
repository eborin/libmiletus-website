<!DOCTYPE html>

<html lang="en">
  <head>
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Lib Miletus website">
    <meta name="author" content="Edson Borin">
  
    <!-- TODO: Replace this icon. -->
    <link rel="icon" href="./images/icone.ico">

    <title>Getting Started</title>

    <!-- Bootstrap core CSS -->
    <link href="./bootstrap-3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="./bootstrap-3.3.7/docs/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="jumbotron.css" rel="stylesheet">
    <link href="navbar-fixed-top.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="./bootstrap-3.3.7/docs/assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        text-align: left;
        padding: 8px;
    }

    tr:nth-child(even){background-color: #e8edff}
  </style>
  </head>

  <body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand">LibMiletus</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="./home.html">Home</a></li>
            <li class="active"><a href="#">Getting Started</a></li>
            <li><a href="./download.html">Download</a></li>
            <li><a href="./supported_platforms.html">Supported Platforms</a></li>
            <li><a href="./how_to_contribute.html">How to contribute</a></li>
            <li><a href="./overview.html">Overview</a></li>
            <li><a href="./wish_list.html">Wish list</a></li>
          </ul>
        </div><!--/.navbar-collapse -->
      </div>
    </nav>


    <!-- QUADRO GERAL -->
    <div class="jumbotron2">
      <div class="container">

  <h1>Getting Started</h1>

  <p>
    LibMiletus is compatible with multiple combinations of
    hardware and software platforms (See more on
    the <a href="./supported_platforms.html">supported platforms
    page</a>).  The following process shows how to setup the
    library to work with NodeMCU and the Arduino IDE.
  </p>

  <p>
    The process includes the following steps:
    <ul>
      <li><a href="#download-arduino">1 - Downloading and installing the Arduino IDE</a></li>
      <li><a href="#esp8266-support">2 - Installing the add-on support for ESP-8266</a></li>
      <li><a href="#installing-dependencies">3 - Installing dependencies</a></li>
      <li><a href="#install-libmiletus">4 - Installing the LibMiletus via Arduino IDE menu</a></li>
      <li><a href="#run-demo">5 - Running the demonstrative example</a></li>
      <ul>
        <li><a href="#run-demo-setup">5a - Configuring and flashing the example</a></li>
        <li><a href="#run-demo-curl">5b - Interacting with the IoT device using the curl command</a></li>
        <li><a href="#run-demo-miletus-app">5c - Interacting with the IoT device using the Miletus App</a></li>
      </ul>
      <li><a href="#troubleshooting">6 - Troubleshooting</a></li>
    </ul>
  </p>


  <h2 id="download-arduino">1 - Downloading and installing the Arduino IDE</h2>

  <p>
    The first step is to download and install the Arduino IDE. Please refer to Arduino 
    <a href="https://www.arduino.cc/en/main/software">official
      website</a> for more information on how to download and
    install the Arduino IDE.
  </p>

  <h2 id="esp8266-support">2 - Installing the add-on support for ESP-8266</h2>

  <p>
    In order to work with the NodeMCU board, you must install
    the <a href="https://github.com/esp8266/Arduino">ESP8266
    Arduino core extensions</a> to the Arduino IDE.
    Acourding <a href="#git-version">our experiments</a>, maybe you should try to install the git version.
    To install it through the Arduino IDE, you can follow the instructions on the link above or:
    <ul>
      <li>
        Start the Arduino IDE and open the “Preferences” window;
      </li>
      <li>
        Enter http://arduino.esp8266.com/stable/package_esp8266com_index.json
        into the “Additional Board Manager URLs” field. You can
        add multiple URLs, separating them by commas;
      </li>
      <li>
        Open  the Boards Manager from the menu “Tools -&gt; Board -&gt; Boards Manager…” and 
        install the esp8266 platform;
      </li>
      <li>
        Once you have installed the support for the esp8266 platform, select your ESP8266 board from the menu “Tools -&gt; Board”.
      </li>
    </ul>
  </p>

  <h3 id="test-nodemcu">Testing the NodeMCU board</h3>

  <p>
    At this point, it may be a good idea to test whether your
    NodeMCU board is working with your Arduino IDE. To do so,
    you may run the Blink example from the examples. 
    The following steps should run the blink example:
    <ul>
      <li>“Tools -&gt; Board -&gt; NodeMCU 1.0 (ESP-12E Module)”</li>
      <li>“Tools -&gt; Port -&gt; Choose a “Serial port”</li>
      <li>“File -&gt; Examples -&gt; ESP8266 -&gt; Blink”</li>
      <li>“Upload”</li>
    </ul>
    Hint: Make sure you select the proper Board and Port. 
  </p>
  <p>
    NodeMCU contains a LED that can be controlled by the user's program.  
    Once you finish uploading the code, this LED must start blinking. 
  </p>
  
  <h2 id="installing-dependencies">3 - Installing dependencies</h2>
  
  <p>Once you have installed the IDE, you have to install the following list of dependecies:</p>
<p>
<table style="width:100%">
<tr> 
  <th>Library</th>
  <th>Author</th>
  <th>Recomended Version</th>
</tr>
<tr> 
  <td>PubSubClient library</td>
  <td>Nick O'Leary</td>
  <td>2.6.0</td>
</tr>
<tr>
  <td>DHT sensor library</td>
  <td>Adafruit</td>
  <td>1.3.0</td>
</tr>
<tr>
  <td>Adafruit Unified Sensor</td>
  <td>Adafruit</td>
  <td>1.0.2</td>
</tr>
<tr>
  <td>Arduino JSON</td>
  <td>Benoite Blanchon</td>
  <td>5.11.1</td>
</tr>
<tr>
  <td>NTPClient</td>
  <td>Fabrice Weinberg</td>
  <td>3.1.0</td>
</tr>
<tr>
  <td>ESP8266 Software Serial*</td>
  <td>Peter Lerup</td>
  <td><a href="https://github.com/plerup/espsoftwareserial">Github</a></td>
</tr>
</table>
<br>
 <small>* Required just for git version.</small>
  </p>

    <h2 id="install-libmiletus">4 - Installing the LibMiletus via Arduino IDE menu</h2>

  <p>The next step is to install the LibMiletus library.
    You may perform this task using the Arduino IDE.

    To do so, you must:
    <ul>
      <li>Download the <a href="https://github.com/MotorolaMobilityLLC/LibMiletus/zipball/master/">latest ZIP</a> version of LibMiletus</li>
      <li>Open the menu “Sketch -&gt; Include Library -&gt; Add .ZIP Library…”</li>
      <li>Point it to the file that you have just downloaded and installed.</li>
    </ul>
  </p>

    <h2 id="run-demo">5 - Running the demonstrative example</h2>
        <p>In the Arduino IDE, open the Example in the menu “<em>File -&gt; Examples -&gt; libMiletus -&gt; <strong>Some_Example</strong></em>”</p>
        <p>Change the SSID, Password, and, optionally, the name of the device.</p>
        <p>Select the appropriate board and upload the program.</p>
        <p>Then you have a functional device.</p>
    <h3 id="run-demo-setup">5a - Configuring and flashing the example</h3>
        <p>Open the example in the menu “File -&gt; Examples -&gt; libMiletus -&gt; NodeMCU-LED” and the Serial Monitor
        “Tools -&gt; Serial Monitor”
        Make sure that data rate for serial data transmission is set to 115200 baud.</p>
        <p>Change the following lines:</p>
        <div class="highlighter-rouge"><pre class="highlight"><code>#define WIFI_SSID "MY_WIFI_SSID"<br />#define WIFI_PASSWORD "MY_WIFI_PASSWORD"</code></pre>
        </div>
        <p>with the name and password of an available wi-fi network and save the file to a custom location.</p>
        
        <p>The blue LED next to the micro USB port should light up and the Serial Monitor should show:</p>
        
        <pre><code class="language-Upload```">Connecting...<br />---<br />Connected to &lt;SSID&gt;<br />IP address: &lt;IP Address&gt;</code></pre>
    <h3 id="run-demo-curl">5b - Interacting with the IoT device using the curl command</h3>
        <p>Run the following command on the terminal, changing the ```IP Address``` for the IP and the port of your board, by default, the port is 1969:</p>
        <div class="highlighter-rouge"><pre class="highlight"><code>$ curl -H "Content-Type: application/json" -X POST -d '{"name":"lamp.toggleLED","component":"lamp","parameters":{}}' &lt;IP Address&gt;:&lt;Port&gt;/commands/execute</code></pre>
        </div>
        <p>Make sure that your device and your computer are on the same network.</p>
        <p>The LED should toggle.</p>
        <p>This command toggles the LED, so running it again will turn it back on.</p>
    <h3 id="run-demo-miletus-app">5c - Interacting with the IoT device using the Miletus App</h3>
        <p>You can use the <a href="https://github.com/MotorolaMobilityLLC/MiletusApp">MiletusApp</a> in your Android smartphone to control your smart devices.</p>
    <p>Download the least App release at the <a href="http://libmiletus.ic.unicamp.br/download.html">download page</a>.</p>
    <p>Based on your traits, a control interface will be dynamically generated in the App.</p>
    <p>Make sure that your device and your Android phone are on the same network.</p>
     <p style="text-align:center;"><img src="./images/miletus_app_1.png" alt="Miletus application image 1" style="width: 350px;height: 622px"/>
       <img src="./images/miletus_app_2.png" alt="Miletus application image 2" style="width: 350px;height: 622px"/>
       <img src="./images/miletus_app_3.png" alt="Miletus application image 3" style="width: 350px;height: 622px"/></p>

  <h2 id="troubleshooting">6 - Troubleshooting</h2>

  <h3 id="git-version">Try the ESP8266-Arduino-core git version (Optional)</h3>
<p>
During some cases in our tests, we face some problems related to the section text fitting in a specific region.
We bypass this problem installing the git version instead of the standard installation.
</p>


</p>
  <h3 id="fix-linking-script">Fixing the linking script (Optional)</h3>

  <p>The ESP8266 extensions for the Arduino IDE include a
    compiler, an assembler and a linker that enables the Arduino IDE
    to generate code for the ESP8266 chip. To this date, the
    linker script, which maps the program sections (code, data,
    ...) into the hardware address space happens to map
    constants at the <tt>iram.text</tt> sections to the RAM
    memory, instead of the Flash. Unfortunately, this may cause
    the system to run out of memory when the program 
    contains large constants, which may be the case when using 
    many String objects.
  </p>
<div class="language-bash highlighter-rouge">
<pre class="highlight">
<code>section .text' will not fit in regioniram1_0_seg'</code>
</pre>

  <p>
    This problem has been reported by some of our users in some versions of the Arduino IDE. In this section,
    we provide instructions so that you
    can modify your linker script to map these constants into the
    Flash memory, instead of RAM. 
  </p>

  <p>
    Before you start, we would like to point out that these
    changes might not be necessary depending on your Arduino
    IDE. In this sense, we recommend that you first try to flash
    the demonstrative example (distributed with LibMiletus) into
    the NodeMCU without trying to fix the linking script. If the
    IDE does not complain about program size, this fix may not be
    necessary.
  </p>

  <p>In order to fix the linking script, your must first locate the linker script file: <strong>“eagle.app.v6.common.ld”</strong>
    <ul>
      <li>
        On Linux it is usually located
        at <code class="highlighter-rouge">~/Arduino/hardware/esp8266/tools/sdk/ld/esp8266com/esp8266/tools/sdk/ld/</code>
      </li>
      <li>
        On MacOS it is usually
        at <code class="highlighter-rouge">~/Library/Arduino15/packages/esp8266/hardware/esp8266/*/tools/sdk/ld/</code>
      </li>
      <li>
        <p>On Windows it is usually
        at <code class="highlighter-rouge">C:\Users\USER\AppData\Roaming\Arduino15\packages\esp8266\hardware\esp8266\2.0.0\tools\sdk\ld\</code>
      </li>
      <li>
        In an Unix-like system you may find this file using the command:
        <div class="language-bash highlighter-rouge">
    <pre class="highlight"><code>find / | grep <span class="s2">"eagle.app.v6.common.ld"</span></code></pre>
        </div>
      </li>
    </ul>
  </p>

  <p>
    Once you have located the file, edit it by moving the “<code class="highlighter-rouge">*.c.o(.iram.text)</code>” entry to line 160, as indicated bellow:

<div class="language-bash highlighter-rouge">
<pre class="highlight">
<code>153     .irom0.text : ALIGN(4)
154     {
155         _irom0_text_start = ABSOLUTE(.);
156         *(.ver_number)
157         *.c.o( EXCLUDE_FILE (umm_malloc.c.o) .literal*, \
158                  EXCLUDE_FILE (umm_malloc.c.o) .text*)
159        *.cpp.o(.literal*, .text*)
160        *.c.o(.iram.text)
161        *libc.a:(.literal .text .literal.* .text.*)
162        *libm.a:(.literal .text .literal.* .text.*)</code>
</pre>

  </p>
  
  <p>
    After you finish editing your script file, run the NodeMCU
    tests again to make sure everything is still working.
  </p>

    <h3 id="fix-ttyusb">Cannot access /dev/ttyUSB0 (Optional)</h3>
<p>
    If the above error (ttyUSB0 can be replaced by the name of your serial port) shows up when you try to upload a program to your Arduino board, run the command:
</p>
<div class="language-bash highlighter-rouge">
<pre class="highlight">
<code>$ sudo chmod a+rw /dev/ttyUSB0</code>
</pre>

      </div> <!-- container -->
    </div> <!-- jumbotron2 -->

<!--
      <footer>
        <p>&copy; 2017 Edson Borin.</p>
      </footer>
-->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="./bootstrap-3.3.7/assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="./bootstrap-3.3.7/dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./bootstrap-3.3.7/docs/assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
